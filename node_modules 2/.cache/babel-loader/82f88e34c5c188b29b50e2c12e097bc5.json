{"ast":null,"code":"/*===========================================================================*\\\n * Requires\n\\*===========================================================================*/\nvar JClass = require('jclass');\n/*===========================================================================*\\\n * HashArray\n\\*===========================================================================*/\n\n\nvar HashArray = JClass._extend({\n  //-----------------------------------\n  // Constructor\n  //-----------------------------------\n  init: function (keyFields, callback, options) {\n    keyFields = keyFields instanceof Array ? keyFields : [keyFields];\n    this._map = {};\n    this._list = [];\n    this.callback = callback;\n    this.keyFields = keyFields;\n    this.isHashArray = true;\n    this.options = options || {\n      ignoreDuplicates: false\n    };\n\n    if (callback) {\n      callback('construct');\n    }\n  },\n  //-----------------------------------\n  // add()\n  //-----------------------------------\n  addOne: function (obj) {\n    var needsDupCheck = false;\n\n    for (var key in this.keyFields) {\n      key = this.keyFields[key];\n      var inst = this.objectAt(obj, key);\n\n      if (inst) {\n        if (this.has(inst)) {\n          if (this.options.ignoreDuplicates) return;\n\n          if (this._map[inst].indexOf(obj) != -1) {\n            // Cannot add the same item twice\n            needsDupCheck = true;\n            continue;\n          }\n\n          this._map[inst].push(obj);\n        } else this._map[inst] = [obj];\n      }\n    }\n\n    if (!needsDupCheck || this._list.indexOf(obj) == -1) this._list.push(obj);\n  },\n  add: function () {\n    for (var i = 0; i < arguments.length; i++) {\n      this.addOne(arguments[i]);\n    }\n\n    if (this.callback) {\n      this.callback('add', Array.prototype.slice.call(arguments, 0));\n    }\n\n    return this;\n  },\n  addAll: function (arr) {\n    if (arr.length < 100) this.add.apply(this, arr);else {\n      for (var i = 0; i < arr.length; i++) this.add(arr[i]);\n    }\n    return this;\n  },\n  addMap: function (key, obj) {\n    this._map[key] = obj;\n\n    if (this.callback) {\n      this.callback('addMap', {\n        key: key,\n        obj: obj\n      });\n    }\n\n    return this;\n  },\n  //-----------------------------------\n  // Intersection, union, etc.\n  //-----------------------------------\n\n  /**\n   * Returns a new HashArray that contains the intersection between this (A) and the hasharray passed in (B). Returns A ^ B.\n   */\n  intersection: function (other) {\n    var self = this;\n    if (!other || !other.isHashArray) throw Error('Cannot HashArray.intersection() on a non-hasharray object. You passed in: ', other);\n    var ret = this.clone(null, true),\n        allItems = this.clone(null, true).addAll(this.all.concat(other.all));\n    allItems.all.forEach(function (item) {\n      if (self.collides(item) && other.collides(item)) ret.add(item);\n    });\n    return ret;\n  },\n\n  /**\n   * Returns a new HashArray that contains the complement (difference) between this hash array (A) and the hasharray passed in (B). Returns A - B.\n   */\n  complement: function (other) {\n    var self = this;\n    if (!other || !other.isHashArray) throw Error('Cannot HashArray.complement() on a non-hasharray object. You passed in: ', other);\n    var ret = this.clone(null, true);\n    this.all.forEach(function (item) {\n      if (!other.collides(item)) ret.add(item);\n    });\n    return ret;\n  },\n  //-----------------------------------\n  // Retrieval\n  //-----------------------------------\n  get: function (key) {\n    return !(this._map[key] instanceof Array) || this._map[key].length != 1 ? this._map[key] : this._map[key][0];\n  },\n  getAll: function (keys) {\n    keys = keys instanceof Array ? keys : [keys];\n    if (keys[0] == '*') return this.all;\n    var res = new HashArray(this.keyFields);\n\n    for (var key in keys) res.add.apply(res, this.getAsArray(keys[key]));\n\n    return res.all;\n  },\n  getAsArray: function (key) {\n    return this._map[key] || [];\n  },\n  getUniqueRandomIntegers: function (count, min, max) {\n    var res = [],\n        map = {};\n    count = Math.min(Math.max(max - min, 1), count);\n\n    while (res.length < count) {\n      var r = Math.floor(min + Math.random() * (max + 1));\n      if (map[r]) continue;\n      map[r] = true;\n      res.push(r);\n    }\n\n    return res;\n  },\n  sample: function (count, keys) {\n    // http://en.wikipedia.org/wiki/Image_(mathematics)\n    var image = this.all,\n        ixs = {},\n        res = [];\n    if (keys) image = this.getAll(keys);\n    var rand = this.getUniqueRandomIntegers(count, 0, image.length - 1);\n\n    for (var i = 0; i < rand.length; i++) res.push(image[rand[i]]);\n\n    return res;\n  },\n  //-----------------------------------\n  // Peeking\n  //-----------------------------------\n  has: function (key) {\n    return this._map.hasOwnProperty(key);\n  },\n  collides: function (item) {\n    for (var k in this.keyFields) if (this.has(this.objectAt(item, this.keyFields[k]))) return true;\n\n    return false;\n  },\n  hasMultiple: function (key) {\n    return this._map[key] instanceof Array;\n  },\n  //-----------------------------------\n  // Removal\n  //-----------------------------------\n  removeByKey: function () {\n    var removed = [];\n\n    for (var i = 0; i < arguments.length; i++) {\n      var key = arguments[i];\n\n      var items = this._map[key].concat();\n\n      if (items) {\n        removed = removed.concat(items);\n\n        for (var j in items) {\n          var item = items[j];\n\n          for (var ix in this.keyFields) {\n            var key2 = this.objectAt(item, this.keyFields[ix]);\n\n            if (key2 && this.has(key2)) {\n              var ix = this._map[key2].indexOf(item);\n\n              if (ix != -1) {\n                this._map[key2].splice(ix, 1);\n              }\n\n              if (this._map[key2].length == 0) delete this._map[key2];\n            }\n          }\n\n          this._list.splice(this._list.indexOf(item), 1);\n        }\n      }\n\n      delete this._map[key];\n    }\n\n    if (this.callback) {\n      this.callback('removeByKey', removed);\n    }\n\n    return this;\n  },\n  remove: function () {\n    for (var i = 0; i < arguments.length; i++) {\n      var item = arguments[i];\n\n      for (var ix in this.keyFields) {\n        var key = this.objectAt(item, this.keyFields[ix]);\n\n        if (key) {\n          var ix = this._map[key].indexOf(item);\n\n          if (ix != -1) this._map[key].splice(ix, 1);else throw new Error('HashArray: attempting to remove an object that was never added!' + key);\n          if (this._map[key].length == 0) delete this._map[key];\n        }\n      }\n\n      var ix = this._list.indexOf(item);\n\n      if (ix != -1) this._list.splice(ix, 1);else throw new Error('HashArray: attempting to remove an object that was never added!' + key);\n    }\n\n    if (this.callback) {\n      this.callback('remove', arguments);\n    }\n\n    return this;\n  },\n  removeAll: function () {\n    var old = this._list.concat();\n\n    this._map = {};\n    this._list = [];\n\n    if (this.callback) {\n      this.callback('remove', old);\n    }\n\n    return this;\n  },\n  //-----------------------------------\n  // Utility\n  //-----------------------------------\n  objectAt: function (obj, path) {\n    if (typeof path === 'string') {\n      return obj[path];\n    }\n\n    var dup = path.concat(); // else assume array.\n\n    while (dup.length && obj) {\n      obj = obj[dup.shift()];\n    }\n\n    return obj;\n  },\n  //-----------------------------------\n  // Iteration\n  //-----------------------------------\n  forEach: function (keys, callback) {\n    keys = keys instanceof Array ? keys : [keys];\n    var objs = this.getAll(keys);\n    objs.forEach(callback);\n    return this;\n  },\n  forEachDeep: function (keys, key, callback) {\n    keys = keys instanceof Array ? keys : [keys];\n    var self = this,\n        objs = this.getAll(keys);\n    objs.forEach(function (item) {\n      callback(self.objectAt(item, key), item);\n    });\n    return this;\n  },\n  //-----------------------------------\n  // Cloning\n  //-----------------------------------\n  clone: function (callback, ignoreItems) {\n    var n = new HashArray(this.keyFields.concat(), callback ? callback : this.callback);\n    if (!ignoreItems) n.add.apply(n, this.all.concat());\n    return n;\n  },\n  //-----------------------------------\n  // Mathematical\n  //-----------------------------------\n  sum: function (keys, key, weightKey) {\n    var self = this,\n        ret = 0;\n    this.forEachDeep(keys, key, function (value, item) {\n      if (weightKey !== undefined) value *= self.objectAt(item, weightKey);\n      ret += value;\n    });\n    return ret;\n  },\n  average: function (keys, key, weightKey) {\n    var ret = 0,\n        tot = 0,\n        weightsTotal = 0,\n        self = this;\n    if (weightKey !== undefined) this.forEachDeep(keys, weightKey, function (value) {\n      weightsTotal += value;\n    });\n    this.forEachDeep(keys, key, function (value, item) {\n      if (weightKey !== undefined) value *= self.objectAt(item, weightKey) / weightsTotal;\n      ret += value;\n      tot++;\n    });\n    return weightKey !== undefined ? ret : ret / tot;\n  },\n  //-----------------------------------\n  // Filtering\n  //-----------------------------------\n  filter: function (keys, callbackOrKey) {\n    var self = this;\n    var callback = typeof callbackOrKey == 'function' ? callbackOrKey : defaultCallback;\n    var ha = new HashArray(this.keyFields);\n    ha.addAll(this.getAll(keys).filter(callback));\n    return ha;\n\n    function defaultCallback(item) {\n      var val = self.objectAt(item, callbackOrKey);\n      return val !== undefined && val !== false;\n    }\n  }\n}); //-----------------------------------\n// Operators\n//-----------------------------------\n\n\nObject.defineProperty(HashArray.prototype, 'all', {\n  get: function () {\n    return this._list;\n  }\n});\nObject.defineProperty(HashArray.prototype, 'map', {\n  get: function () {\n    return this._map;\n  }\n});\nmodule.exports = HashArray; //-----------------------------------\n// Browser\n//-----------------------------------\n\nif (typeof window !== 'undefined') window.HashArray = HashArray;","map":{"version":3,"sources":["/Users/jasmineharris/Desktop/Elite/woto/node_modules/hasharray/src/HashArray.js"],"names":["JClass","require","HashArray","_extend","init","keyFields","callback","options","Array","_map","_list","isHashArray","ignoreDuplicates","addOne","obj","needsDupCheck","key","inst","objectAt","has","indexOf","push","add","i","arguments","length","prototype","slice","call","addAll","arr","apply","addMap","intersection","other","self","Error","ret","clone","allItems","all","concat","forEach","item","collides","complement","get","getAll","keys","res","getAsArray","getUniqueRandomIntegers","count","min","max","map","Math","r","floor","random","sample","image","ixs","rand","hasOwnProperty","k","hasMultiple","removeByKey","removed","items","j","ix","key2","splice","remove","removeAll","old","path","dup","shift","objs","forEachDeep","ignoreItems","n","sum","weightKey","value","undefined","average","tot","weightsTotal","filter","callbackOrKey","defaultCallback","ha","val","Object","defineProperty","module","exports","window"],"mappings":"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","sourcesContent":["/*===========================================================================*\\\n * Requires\n\\*===========================================================================*/\nvar JClass = require('jclass');\n\n/*===========================================================================*\\\n * HashArray\n\\*===========================================================================*/\nvar HashArray = JClass._extend({\n  //-----------------------------------\n  // Constructor\n  //-----------------------------------\n  init: function(keyFields, callback, options) {\n    keyFields = keyFields instanceof Array ? keyFields : [keyFields];\n\n    this._map = {};\n    this._list = [];\n    this.callback = callback;\n\n    this.keyFields = keyFields;\n\n    this.isHashArray = true;\n    \n    this.options = options || {\n      ignoreDuplicates: false\n    };\n\n    if (callback) {\n      callback('construct');\n    }\n  },\n  //-----------------------------------\n  // add()\n  //-----------------------------------\n  addOne: function (obj) {\n    var needsDupCheck = false;\n    for (var key in this.keyFields) {\n      key = this.keyFields[key];\n      var inst = this.objectAt(obj, key);\n      if (inst) {\n        if (this.has(inst)) {\n          if (this.options.ignoreDuplicates)\n            return;\n          if (this._map[inst].indexOf(obj) != -1) {\n            // Cannot add the same item twice\n            needsDupCheck = true;\n            continue;\n          }\n          this._map[inst].push(obj);\n        }\n        else this._map[inst] = [obj];\n      }\n    }\n\n    if (!needsDupCheck || this._list.indexOf(obj) == -1)\n      this._list.push(obj);\n  },\n  add: function() {\n    for (var i = 0; i < arguments.length; i++) {\n      this.addOne(arguments[i]);\n    }\n\n    if (this.callback) {\n      this.callback('add', Array.prototype.slice.call(arguments, 0));\n    }\n    \n    return this;\n  },\n  addAll: function (arr) {\n    if (arr.length < 100)\n      this.add.apply(this, arr);\n    else {\n      for (var i = 0; i < arr.length; i++)\n        this.add(arr[i]);\n    }\n    \n    return this;\n  },\n  addMap: function(key, obj) {\n    this._map[key] = obj;\n    if (this.callback) {\n      this.callback('addMap', {\n        key: key,\n        obj: obj\n      });\n    }\n    \n    return this;\n  },\n  //-----------------------------------\n  // Intersection, union, etc.\n  //-----------------------------------\n  /**\n   * Returns a new HashArray that contains the intersection between this (A) and the hasharray passed in (B). Returns A ^ B.\n   */\n  intersection: function (other) {\n    var self = this;\n\n    if (!other || !other.isHashArray)\n      throw Error('Cannot HashArray.intersection() on a non-hasharray object. You passed in: ', other);\n\n    var ret = this.clone(null, true),\n      allItems = this.clone(null, true).addAll(this.all.concat(other.all));\n\n    allItems.all.forEach(function (item) {\n      if (self.collides(item) && other.collides(item))\n        ret.add(item);\n    });\n\n    return ret;\n  },\n  /**\n   * Returns a new HashArray that contains the complement (difference) between this hash array (A) and the hasharray passed in (B). Returns A - B.\n   */\n  complement: function (other) {\n    var self = this;\n\n    if (!other || !other.isHashArray)\n      throw Error('Cannot HashArray.complement() on a non-hasharray object. You passed in: ', other);\n\n    var ret = this.clone(null, true);\n\n    this.all.forEach(function (item) {\n      if (!other.collides(item))\n        ret.add(item);\n    });\n\n    return ret;\n  },\n  //-----------------------------------\n  // Retrieval\n  //-----------------------------------\n  get: function(key) {\n    return (!(this._map[key] instanceof Array) || this._map[key].length != 1) ? this._map[key] : this._map[key][0];\n  },\n  getAll: function(keys) {\n    keys = keys instanceof Array ? keys : [keys];\n\n    if (keys[0] == '*')\n      return this.all;\n\n    var res = new HashArray(this.keyFields);\n    for (var key in keys)\n      res.add.apply(res, this.getAsArray(keys[key]));\n\n    return res.all;\n  },\n  getAsArray: function(key) {\n    return this._map[key] || [];\n  },\n  getUniqueRandomIntegers: function (count, min, max) {\n    var res = [], map = {};\n\n    count = Math.min(Math.max(max - min, 1), count);\n    \n    while (res.length < count)\n    {\n      var r = Math.floor(min + (Math.random() * (max + 1)));\n      if (map[r]) continue;\n      map[r] = true;\n      res.push(r);\n    }\n\n    return res;\n  },\n  sample: function (count, keys) {\n    // http://en.wikipedia.org/wiki/Image_(mathematics)\n    var image = this.all,\n      ixs = {},\n      res = [];\n\n    if (keys)\n      image = this.getAll(keys);\n\n    var rand = this.getUniqueRandomIntegers(count, 0, image.length - 1);\n\n    for (var i = 0; i < rand.length; i++)\n      res.push(image[rand[i]]);\n\n    return res;\n  },\n  //-----------------------------------\n  // Peeking\n  //-----------------------------------\n  has: function(key) {\n    return this._map.hasOwnProperty(key);\n  },\n  collides: function (item) {\n    for (var k in this.keyFields)\n      if (this.has(this.objectAt(item, this.keyFields[k])))\n        return true;\n    \n    return false;\n  },\n  hasMultiple: function(key) {\n    return this._map[key] instanceof Array;\n  },\n  //-----------------------------------\n  // Removal\n  //-----------------------------------\n  removeByKey: function() {\n    var removed = [];\n    for (var i = 0; i < arguments.length; i++) {\n      var key = arguments[i];\n      var items = this._map[key].concat();\n      if (items) {\n        removed = removed.concat(items);\n        for (var j in items) {\n          var item = items[j];\n          for (var ix in this.keyFields) {\n            var key2 = this.objectAt(item, this.keyFields[ix]);\n            if (key2 && this.has(key2)) {\n              var ix = this._map[key2].indexOf(item);\n              if (ix != -1) {\n                this._map[key2].splice(ix, 1);\n              }\n\n              if (this._map[key2].length == 0)\n                delete this._map[key2];\n            }\n          }\n\n          this._list.splice(this._list.indexOf(item), 1);\n        }\n      }\n      delete this._map[key];\n    }\n\n    if (this.callback) {\n      this.callback('removeByKey', removed);\n    }\n    \n    return this;\n  },\n  remove: function() {\n    for (var i = 0; i < arguments.length; i++) {\n      var item = arguments[i];\n      for (var ix in this.keyFields) {\n        var key = this.objectAt(item, this.keyFields[ix]);\n        if (key) {\n          var ix = this._map[key].indexOf(item);\n          if (ix != -1)\n            this._map[key].splice(ix, 1);\n          else\n            throw new Error('HashArray: attempting to remove an object that was never added!' + key);\n\n          if (this._map[key].length == 0)\n            delete this._map[key];\n        }\n      }\n\n      var ix = this._list.indexOf(item);\n\n      if (ix != -1)\n        this._list.splice(ix, 1);\n      else\n        throw new Error('HashArray: attempting to remove an object that was never added!' + key);\n    }\n\n    if (this.callback) {\n      this.callback('remove', arguments);\n    }\n    \n    return this;\n  },\n  removeAll: function() {\n    var old = this._list.concat();\n    this._map = {};\n    this._list = [];\n\n    if (this.callback) {\n      this.callback('remove', old);\n    }\n    \n    return this;\n  },\n  //-----------------------------------\n  // Utility\n  //-----------------------------------\n  objectAt: function(obj, path) {\n    if (typeof path === 'string') {\n      return obj[path];\n    }\n\n    var dup = path.concat();\n    // else assume array.\n    while (dup.length && obj) {\n      obj = obj[dup.shift()];\n    }\n\n    return obj;\n  },\n  //-----------------------------------\n  // Iteration\n  //-----------------------------------\n  forEach: function(keys, callback) {\n    keys = keys instanceof Array ? keys : [keys];\n\n    var objs = this.getAll(keys);\n\n    objs.forEach(callback);\n    \n    return this;\n  },\n  forEachDeep: function(keys, key, callback) {\n    keys = keys instanceof Array ? keys : [keys];\n\n    var self = this,\n      objs = this.getAll(keys);\n\n    objs.forEach(function (item) {\n      callback(self.objectAt(item, key), item);\n    });\n    \n    return this;\n  },\n  //-----------------------------------\n  // Cloning\n  //-----------------------------------\n  clone: function(callback, ignoreItems) {\n    var n = new HashArray(this.keyFields.concat(), callback ? callback : this.callback);\n    if (!ignoreItems)\n      n.add.apply(n, this.all.concat());\n    return n;\n  },\n  //-----------------------------------\n  // Mathematical\n  //-----------------------------------\n  sum: function(keys, key, weightKey) {\n    var self = this,\n      ret = 0;\n    this.forEachDeep(keys, key, function (value, item) {\n      if (weightKey !== undefined)\n        value *= self.objectAt(item, weightKey);\n\n      ret += value;\n    });\n    return ret;\n  },\n  average: function(keys, key, weightKey) {\n    var ret = 0,\n      tot = 0,\n      weightsTotal = 0,\n      self = this;\n\n    if (weightKey !== undefined)\n      this.forEachDeep(keys, weightKey, function (value) {\n        weightsTotal += value;\n      })\n\n    this.forEachDeep(keys, key, function (value, item) {\n      if (weightKey !== undefined)\n        value *= (self.objectAt(item, weightKey) / weightsTotal);\n\n      ret += value;\n      tot++;\n    });\n\n    return weightKey !== undefined ? ret : ret / tot;\n  },\n  //-----------------------------------\n  // Filtering\n  //-----------------------------------\n  filter: function (keys, callbackOrKey) {\n    var self = this;\n    \n    var callback = (typeof(callbackOrKey) == 'function') ? callbackOrKey : defaultCallback;\n\n    var ha = new HashArray(this.keyFields);\n    ha.addAll(this.getAll(keys).filter(callback));\n    return ha;\n    \n    function defaultCallback(item) {\n      var val = self.objectAt(item, callbackOrKey);\n      return val !== undefined && val !== false;\n    }\n  }\n});\n\n//-----------------------------------\n// Operators\n//-----------------------------------\nObject.defineProperty(HashArray.prototype, 'all', {\n  get: function () {\n    return this._list;\n  }\n});\n\nObject.defineProperty(HashArray.prototype, 'map', {\n  get: function () {\n    return this._map;\n  }\n});\n\nmodule.exports = HashArray;\n\n//-----------------------------------\n// Browser\n//-----------------------------------\nif (typeof window !== 'undefined')\n  window.HashArray = HashArray;"]},"metadata":{},"sourceType":"script"}